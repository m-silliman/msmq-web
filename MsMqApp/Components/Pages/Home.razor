@page "/"
@rendermode InteractiveServer
@inherits HomeBase

<PageTitle>MSMQ Manager - Home</PageTitle>

<div class="home-page">
    <!-- Connection Status Header -->
    <div class="connection-header">
        <div class="connection-info">
            <i class="bi bi-hdd-network me-2"></i>
            <span class="connection-label">Connected to:</span>
            <strong class="connection-name">@(CurrentConnection?.DisplayName ?? "Not Connected")</strong>
            @if (CurrentConnection != null)
            {
                <ConnectionStatusBadge Status="@CurrentConnection.Status" />
            }
        </div>
        <div class="connection-actions">
            <button class="btn btn-sm btn-outline-primary me-2"
                    @onclick="ConnectToLocalhostAsync"
                    disabled="@(CurrentConnection?.IsLocal == true)"
                    title="Connect to local computer">
                <i class="bi bi-house-door me-1"></i>
                Localhost
            </button>
            <button class="btn btn-sm btn-primary"
                    @onclick="OpenConnectDialog"
                    title="Connect to a remote computer">
                <i class="bi bi-link-45deg me-1"></i>
                Connect to Computer...
            </button>
        </div>
    </div>

    <!-- Three-Panel Layout -->
    <div class="home-content">
        <!-- Left Panel: Queue Tree View -->
        <div class="left-panel" style="@GetLeftPanelStyle()">
            <QueueTreeView Connection="@CurrentConnection"
                           SelectedQueue="@SelectedQueue"
                           CurrentViewType="@CurrentViewType"
                           OnNodeSelected="@HandleNodeSelectedAsync"
                           OnRefreshRequested="@RefreshQueuesAsync"
                           OnPurgeRequested="@HandlePurgeRequestedAsync"
                           ShowRefreshButton="true"
                           ShowConnectionDetails="true" />
        </div>

        <!-- Resizable Splitter -->
        <div class="panel-splitter"
             @onmousedown="StartResizeAsync"
             @onmousedown:preventDefault="true"
             title="Drag to resize panels">
            <div class="splitter-handle"></div>
        </div>

        <!-- Right Panel: Message List -->
        <div class="right-panel" style="@GetRightPanelStyle()">
            <MessageList Messages="@Messages"
                         SelectedQueue="@SelectedQueue"
                         ViewType="@CurrentViewType"
                         SelectedMessage="@SelectedMessage"
                         SelectedMessageChanged="@HandleMessageSelectedAsync"
                         OnMessageSelected="@HandleMessageSelectedAsync"
                         OnSelectionChanged="@HandleSelectionChangedAsync"
                         OnRefresh="@RefreshMessagesAsync"
                         OnMessagesDeleted="@HandleMessagesDeletedAsync"
                         MessageOperationsService="@MessageOperationsService"
                         AutoRefreshEnabled="@AutoRefreshEnabled"
                         RefreshIntervalSeconds="@RefreshIntervalSeconds"
                         IsLoading="@IsLoadingMessages"
                         IsRefreshing="@IsRefreshing" />
        </div>
    </div>

    <!-- Message Detail Drawer -->
    <MessageDetail Message="@SelectedMessage"
                   IsOpen="@IsDetailDrawerOpen"
                   IsOpenChanged="@((bool value) => IsDetailDrawerOpen = value)"
                   OnClose="@CloseDetailDrawerAsync"
                   OnDelete="@HandleDeleteMessageAsync"
                   OnMove="@HandleMoveMessageAsync"
                   OnExport="@HandleExportMessageAsync"
                   OnResend="@HandleResendMessageAsync" />

    <!-- Confirmation Dialog for Destructive Operations -->
    <ConfirmationDialog @bind-IsOpen="@IsConfirmDialogOpen"
                        Title="@ConfirmDialogTitle"
                        Message="@ConfirmDialogMessage"
                        Severity="@ConfirmDialogSeverity"
                        ConfirmButtonText="@ConfirmButtonText"
                        OnConfirm="@HandleConfirmAsync"
                        OnCancel="@HandleCancelAsync" />

    <!-- Connect to Computer Dialog -->
    <ConnectToComputerDialog @ref="ConnectDialogRef"
                             @bind-IsOpen="@IsConnectDialogOpen"
                             LastSuccessfulComputer="@LastSuccessfulComputer"
                             OnConnected="@HandleConnectionRequestAsync"
                             OnCancelled="@HandleConnectionCancelledAsync" />

    <!-- Purge Confirmation Dialog -->
    <PurgeConfirmationDialog @bind-IsOpen="@IsPurgeDialogOpen"
                             Queue="@SelectedQueue"
                             ViewType="@CurrentViewType"
                             IsProcessing="@IsPurgeProcessing"
                             ErrorMessage="@PurgeErrorMessage"
                             OnConfirm="@HandlePurgeConfirmAsync"
                             OnCancel="@HandlePurgeCancelAsync" />
</div>
