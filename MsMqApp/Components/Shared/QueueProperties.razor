@namespace MsMqApp.Components.Shared
@inherits QueuePropertiesBase

<div class="queue-properties">
    @if (Queue != null)
    {
        <div class="properties-header">
            <div class="queue-icon">
                <i class="bi bi-inbox-fill"></i>
            </div>
            <div class="header-content">
                <h4 class="queue-name">@Queue.Name</h4>
                <p class="queue-path text-muted">@Queue.Path</p>
            </div>
        </div>

        <div class="properties-tabs">
            <ul class="nav nav-tabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active"
                            type="button"
                            role="tab">
                        General
                    </button>
                </li>
            </ul>

            <div class="tab-content">
                <div class="tab-pane active">
                        <div class="properties-form">
                            @if (!string.IsNullOrEmpty(SuccessMessage))
                            {
                                <div class="alert alert-success alert-dismissible fade show" role="alert">
                                    <i class="bi bi-check-circle-fill me-2"></i>
                                    @SuccessMessage
                                    <button type="button" class="btn-close" @onclick="() => SuccessMessage = null"></button>
                                </div>
                            }

                            @if (!string.IsNullOrEmpty(ValidationError))
                            {
                                <div class="alert alert-danger alert-dismissible fade show" role="alert">
                                    <i class="bi bi-exclamation-triangle-fill me-2"></i>
                                    @ValidationError
                                    <button type="button" class="btn-close" @onclick="() => ValidationError = null"></button>
                                </div>
                            }

                            <!-- Edit Mode Toggle -->
                            @if (!IsEditMode)
                            {
                                <div class="mb-3">
                                    <button class="btn btn-sm btn-outline-primary" @onclick="EnterEditMode">
                                        <i class="bi bi-pencil me-1"></i>
                                        Edit Properties
                                    </button>
                                </div>
                            }

                            <!-- Label -->
                            <div class="form-group row">
                                <label class="col-sm-3 col-form-label">
                                    Label:
                                    @if (IsDirty && EditLabel != Queue?.Label)
                                    {
                                        <span class="text-danger">*</span>
                                    }
                                </label>
                                <div class="col-sm-9">
                                    <input type="text" 
                                           class="form-control @(FieldErrors.ContainsKey("Label") ? "is-invalid" : "")" 
                                           @bind="EditLabel" 
                                           @bind:event="oninput"
                                           @onchange="OnFieldChanged"
                                           readonly="@(!IsEditMode)" />
                                    @if (FieldErrors.ContainsKey("Label"))
                                    {
                                        <div class="invalid-feedback d-block">@FieldErrors["Label"]</div>
                                    }
                                </div>
                            </div>

                            <!-- Type ID (Read-only) -->
                            <div class="form-group row">
                                <label class="col-sm-3 col-form-label">Type ID:</label>
                                <div class="col-sm-9">
                                    <input type="text" 
                                           class="form-control" 
                                           value="@GetTypeIdDisplay()"
                                           readonly />
                                    <small class="form-text text-muted">Type ID cannot be changed after queue creation</small>
                                </div>
                            </div>

                            <!-- Checkboxes -->
                            <div class="form-group row">
                                <div class="col-sm-9 offset-sm-3">
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" 
                                               type="checkbox" 
                                               id="limitMessageStorage"
                                               @bind="EditLimitMessageStorage"
                                               @bind:after="OnFieldChanged"
                                               disabled="@(!IsEditMode)" />
                                        <label class="form-check-label" for="limitMessageStorage">
                                            Limit message storage to (KB):
                                            @if (IsDirty && EditLimitMessageStorage != (Queue?.MaximumQueueSize > 0))
                                            {
                                                <span class="text-danger">*</span>
                                            }
                                        </label>
                                    </div>
                                    @if (EditLimitMessageStorage)
                                    {
                                        <div class="ms-4 mb-2">
                                            <input type="number" 
                                                   class="form-control form-control-sm @(FieldErrors.ContainsKey("MaximumQueueSize") ? "is-invalid" : "")" 
                                                   style="max-width: 200px;"
                                                   @bind="EditMaximumQueueSize"
                                                   @bind:after="OnFieldChanged"
                                                   min="1"
                                                   readonly="@(!IsEditMode)" />
                                            @if (FieldErrors.ContainsKey("MaximumQueueSize"))
                                            {
                                                <div class="invalid-feedback d-block">@FieldErrors["MaximumQueueSize"]</div>
                                            }
                                        </div>
                                    }

                                    <div class="form-check mb-2">
                                        <input class="form-check-input" 
                                               type="checkbox" 
                                               id="authenticated"
                                               @bind="EditAuthenticate"
                                               @bind:after="OnFieldChanged"
                                               disabled="@(!IsEditMode)" />
                                        <label class="form-check-label" for="authenticated">
                                            Authenticated
                                            @if (IsDirty && EditAuthenticate != Queue?.Authenticate)
                                            {
                                                <span class="text-danger">*</span>
                                            }
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" 
                                               type="checkbox" 
                                               checked="@Queue?.IsTransactional" 
                                               disabled />
                                        <label class="form-check-label">
                                            Transactional queue
                                            <small class="text-muted">(cannot be changed)</small>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- Privacy Level -->
                            <div class="form-group row">
                                <label class="col-sm-3 col-form-label" for="privacyLevel">
                                    Privacy level:
                                    @if (IsDirty && EditPrivacyLevel != Queue?.PrivacyLevel)
                                    {
                                        <span class="text-danger">*</span>
                                    }
                                </label>
                                <div class="col-sm-9">
                                    <select class="form-select" 
                                            id="privacyLevel"
                                            @bind="EditPrivacyLevel"
                                            @bind:after="OnFieldChanged"
                                            disabled="@(!IsEditMode)">
                                        <option value="0">None</option>
                                        <option value="1">Optional</option>
                                        <option value="2">Body</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Journal Section -->
                            <div class="journal-section">
                                <h6>Journal</h6>
                                <div class="form-group row">
                                    <div class="col-sm-9 offset-sm-3">
                                        <div class="form-check mb-2">
                                            <input class="form-check-input" 
                                                   type="checkbox" 
                                                   id="journalEnabled"
                                                   @bind="EditJournalEnabled"
                                                   @bind:after="OnFieldChanged"
                                                   disabled="@(!IsEditMode)" />
                                            <label class="form-check-label" for="journalEnabled">
                                                Enabled
                                                @if (IsDirty && EditJournalEnabled != Queue?.UseJournalQueue)
                                                {
                                                    <span class="text-danger">*</span>
                                                }
                                            </label>
                                        </div>
                                        <div class="form-check mb-2">
                                            <input class="form-check-input" 
                                                   type="checkbox" 
                                                   id="limitJournalStorage"
                                                   @bind="EditLimitJournalStorage"
                                                   @bind:after="OnFieldChanged"
                                                   disabled="@(!IsEditMode)" />
                                            <label class="form-check-label" for="limitJournalStorage">
                                                Limit journal storage to (KB):
                                                @if (IsDirty && EditLimitJournalStorage != (Queue?.MaximumJournalSize > 0))
                                                {
                                                    <span class="text-danger">*</span>
                                                }
                                            </label>
                                        </div>
                                        @if (EditLimitJournalStorage)
                                        {
                                            <div class="ms-4 mb-2">
                                                <input type="number" 
                                                       class="form-control form-control-sm @(FieldErrors.ContainsKey("MaximumJournalSize") ? "is-invalid" : "")" 
                                                       style="max-width: 200px;"
                                                       @bind="EditMaximumJournalSize"
                                                       @bind:after="OnFieldChanged"
                                                       min="1"
                                                       readonly="@(!IsEditMode)" />
                                                @if (FieldErrors.ContainsKey("MaximumJournalSize"))
                                                {
                                                    <div class="invalid-feedback d-block">@FieldErrors["MaximumJournalSize"]</div>
                                                }
                                            </div>
                                        }
                                    </div>
                                </div>
                            </div>

                            <!-- Action Buttons -->
                            @if (IsEditMode)
                            {
                                <div class="action-buttons">
                                    <button class="btn btn-primary" 
                                            @onclick="OnSaveAsync"
                                            disabled="@(!IsDirty || IsSaving)">
                                        @if (IsSaving)
                                        {
                                            <span class="spinner-border spinner-border-sm me-1" role="status"></span>
                                        }
                                        else
                                        {
                                            <i class="bi bi-check-lg me-1"></i>
                                        }
                                        Save
                                    </button>
                                    <button class="btn btn-secondary" 
                                            @onclick="OnCancel"
                                            disabled="@IsSaving">
                                        <i class="bi bi-x-lg me-1"></i>
                                        Cancel
                                    </button>
                                    <button class="btn btn-outline-secondary" 
                                            @onclick="OnApply"
                                            disabled="@(!IsDirty || IsSaving)">
                                        Apply
                                    </button>
                                </div>
                            }

                            <!-- Warning Message -->
                            @if (!EditAuthenticate)
                            {
                                <div class="alert alert-warning d-flex align-items-center mt-3" role="alert">
                                    <i class="bi bi-exclamation-triangle-fill me-2"></i>
                                    <div>
                                        Queue is unauthenticated. Message senders can bypass the Access Control settings.
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            </div>
    }
    else
    {
        <div class="no-queue-selected">
            <i class="bi bi-inbox text-muted"></i>
            <p class="text-muted">No queue selected</p>
        </div>
    }
</div>