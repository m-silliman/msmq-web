@namespace MsMqApp.Components.Shared
@inherits QueueTreeViewBase

<div class="queue-tree-view">
    @if (Connection != null)
    {
        <div class="queue-tree-header">
            <div class="connection-info">
                <ConnectionStatusBadge Status="@Connection.Status"
                                       ShowLabel="true"
                                       ShowDetails="@ShowConnectionDetails"
                                       Details="@GetConnectionDetails()" />
            </div>

            @if (ShouldShowPurgeButton())
            {
                <button class="btn btn-sm btn-danger purge-button me-2"
                        @onclick="OnPurgeClickedAsync"
                        disabled="@(Connection.IsRefreshing || IsRefreshing)"
                        title="Purge all messages from selected queue">
                    <i class="bi bi-trash" aria-hidden="true"></i>
                    <span class="ms-1">Purge</span>
                </button>
            }

            @if (ShouldShowSendMessageButton())
            {
                <button class="btn btn-sm btn-primary send-message-button me-2"
                        @onclick="OnSendMessageClickedAsync"
                        disabled="@(Connection.IsRefreshing || IsRefreshing)"
                        title="Send a message to selected queue">
                    <i class="bi bi-envelope-plus-fill" aria-hidden="true"></i>
                    <span class="ms-1">Send Message</span>
                </button>
            }

            @if (ShowRefreshButton)
            {
                <button class="btn btn-sm btn-outline-secondary refresh-button"
                        @onclick="OnRefreshClickedAsync"
                        disabled="@(Connection.IsRefreshing || IsRefreshing)"
                        title="Refresh queue list">
                    <i class="bi @GetRefreshIconClass()" aria-hidden="true"></i>
                    @if (ShowRefreshLabel)
                    {
                        <span class="ms-1">Refresh</span>
                    }
                </button>
            }
        </div>

        <div class="queue-tree-content">
            @if (Connection.IsRefreshing || IsRefreshing)
            {
                <div class="text-center py-3">
                    <LoadingSpinner Size="SpinnerSize.Small" Message="Loading queues..." />
                </div>
            }
            else if (TreeRoot != null)
            {
                @if (TreeRoot.Children.Any())
                {
                    <div class="tree-nodes" role="tree" aria-label="Queue tree">
                        @foreach (var child in TreeRoot.Children)
                        {
                            <TreeNode @key="child.Id"
                                      NodeData="@child"
                                      OnNodeClick="@HandleNodeClickAsync"
                                      OnNodeToggle="@HandleNodeToggleAsync" />
                        }
                    </div>
                }
                else
                {
                    <div class="no-queues-message">
                        <i class="bi bi-inbox text-muted" aria-hidden="true"></i>
                        <p class="text-muted mb-0">No queues found</p>
                    </div>
                }
            }
            else if (!string.IsNullOrWhiteSpace(ErrorMessage))
            {
                <div class="alert alert-danger mb-0" role="alert">
                    <i class="bi bi-exclamation-triangle" aria-hidden="true"></i>
                    <span>@ErrorMessage</span>
                </div>
            }
        </div>
    }
    else
    {
        <div class="no-connection-message">
            <i class="bi bi-plug text-muted" aria-hidden="true"></i>
            <p class="text-muted mb-0">No connection selected</p>
        </div>
    }
</div>
