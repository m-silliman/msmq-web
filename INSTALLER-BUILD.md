# NSIS Installer Build Guide

This document explains how to build a Windows installer for the MSMQ Manager application using NSIS (Nullsoft Scriptable Install System).

## Prerequisites

1. **NSIS Installation**
   - Download and install NSIS from [https://nsis.sourceforge.io/](https://nsis.sourceforge.io/)
   - Recommended version: NSIS 3.08 or later
   - Install to default location (`C:\Program Files (x86)\NSIS\`)

2. **No Additional Plugins Required**
   - The installer now uses built-in Windows commands (`sc` and `netsh`)
   - No external NSIS plugins are needed

3. **Built Application**
   - Run `.\build-standalone.ps1` first to create the distribution in `.\dist\`

## Quick Setup

1. **Build the application distribution**:
   ```powershell
   .\build-standalone.ps1
   ```

2. **Create the installer**:
   ```powershell
   .\build-installer.ps1
   ```

## Build Scripts

### build-installer.ps1

The main script that generates and builds the NSIS installer.

**Parameters:**
- `-OutputPath` - Where to create installer (default: `.\installer`)
- `-DistPath` - Distribution folder path (default: `.\dist`)
- `-AppVersion` - Version number (default: `1.0.0`)
- `-CompanyName` - Company name for metadata (default: `Your Company`)
- `-NSISPath` - Path to makensis.exe (auto-detected if not specified)

**Examples:**
```powershell
# Basic build
.\build-installer.ps1

# Custom version and company
.\build-installer.ps1 -AppVersion "2.1.0" -CompanyName "Acme Corp"

# Custom output location
.\build-installer.ps1 -OutputPath "C:\Installers"

# Specify NSIS path manually
.\build-installer.ps1 -NSISPath "C:\Tools\NSIS\makensis.exe"
```

## Installer Features

The generated installer provides:

### ‚úÖ Core Features
- **User-selectable installation path**
- **Automatic Windows Service registration**
- **Configurable web interface port** (default: 8080)
- **Automatic firewall rule creation**
- **Desktop shortcut to web interface**
- **Start Menu shortcuts**
- **Add/Remove Programs integration**
- **Clean uninstaller with complete service removal**

### üîß Service Configuration Page
- Option to install as Windows Service (recommended)
- Choice to start service after installation
- Configurable web interface port
- Shortcut creation options

### üõ°Ô∏è Security & Permissions
- Requires Administrator privileges
- 64-bit Windows validation
- Automatic firewall configuration
- Service runs with appropriate permissions

## Installer Output

The build process creates:

```
installer/
‚îú‚îÄ‚îÄ MSMQManagerSetup-v1.0.0.exe    # Main installer executable
‚îî‚îÄ‚îÄ installer.nsi                   # Generated NSIS script (for reference)
```

## Installation Process

When users run the installer:

1. **License Agreement** - MIT license display
2. **Component Selection** - Choose features to install
3. **Installation Directory** - Select where to install
4. **Service Configuration** - Configure service settings
5. **Installation** - Copy files and register service
6. **Completion** - Launch options and next steps

## Uninstallation

The installer creates a complete uninstaller that:
- Stops and removes the Windows Service
- Removes all application files
- Cleans up registry entries
- Removes firewall rules
- Deletes shortcuts

Access via:
- Add/Remove Programs in Control Panel
- Start Menu ‚Üí MSMQ Manager ‚Üí Uninstall
- Run `uninstall.exe` from installation directory

## Troubleshooting

### Common Build Issues

1. **"ServiceLib plugin not found"**
   - Solution: Download and install ServiceLib plugin (see Prerequisites)

2. **"NSIS not found"**
   - Solution: Install NSIS or specify path with `-NSISPath`

3. **"Distribution folder not found"**
   - Solution: Run `.\build-standalone.ps1` first

4. **"Access denied" during build**
   - Solution: Run PowerShell as Administrator

### Common Installation Issues

1. **"Administrator privileges required"**
   - Solution: Right-click installer, "Run as administrator"

2. **Service fails to start**
   - Check Windows Event Viewer for service errors
   - Verify MSMQ feature is installed on target machine
   - Check firewall rules and port availability

3. **Web interface not accessible**
   - Verify service is running: `sc query MSMQMonitor`
   - Check configured port in `appsettings.json`
   - Ensure firewall rule is created

## Customization

### Modifying the Installer

The NSIS script is generated by `build-installer.ps1`. To customize:

1. Edit the script generation section in `build-installer.ps1`
2. Modify variables like `$AppName`, `$ServiceName`, `$DefaultPort`
3. Add custom installer pages or components
4. Modify the license text generation

### Branding

Update these variables in `build-installer.ps1`:
- `$AppDisplayName` - Application display name
- `$CompanyName` - Your company name
- `$AppWebsite` - Support website URL
- `$AppDescription` - Application description

### Version Information

The installer automatically includes:
- Product version from `-AppVersion` parameter
- File version information
- Copyright notices
- Company metadata

## Distribution

The generated installer is fully self-contained and can be distributed via:
- Direct download from website
- Network shares
- Software deployment systems
- Package managers (Chocolatey, etc.)

## Advanced Configuration

### Silent Installation

The installer supports silent installation:
```cmd
MSMQManagerSetup-v1.0.0.exe /S /D=C:\MyCustomPath
```

### Service Configuration via Registry

Advanced users can pre-configure service settings via registry:
```reg
[HKEY_LOCAL_MACHINE\SOFTWARE\Your Company\MSMQ Manager]
"ServicePort"=dword:00001f90
"AutoStart"=dword:00000001
```

## Build Automation

For CI/CD integration:

```yaml
# Example GitHub Actions step
- name: Build Installer
  run: |
    .\build-standalone.ps1 -Configuration Release
    .\build-installer.ps1 -AppVersion "${{ github.ref_name }}" -CompanyName "My Company"
```

## Support

For installer-related issues:
1. Check the generated `installer.nsi` file for NSIS syntax
2. Review NSIS documentation at [https://nsis.sourceforge.io/Docs/](https://nsis.sourceforge.io/Docs/)
3. Verify all required plugins are installed
4. Test on a clean Windows machine

---

**Note**: The installer requires the target machine to have MSMQ feature installed. Consider adding an MSMQ detection and installation prompt for production deployments.